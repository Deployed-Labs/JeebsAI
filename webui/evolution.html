<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Evolution Dashboard - JeebsAI</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="/webui/style.css"/>
<style>
.live-dot{width:10px;height:10px;border-radius:50%;background:var(--good);display:inline-block}
.live-dot.off{background:var(--muted)}
.live-dot:not(.off){animation:pulse-ring 2s ease-out infinite}
@keyframes pulse-ring{0%{box-shadow:0 0 0 0 rgba(74,222,128,.5)}70%{box-shadow:0 0 0 8px transparent}100%{box-shadow:0 0 0 0 transparent}}
.severity{padding:2px 8px;border-radius:4px;font-size:0.8em;font-weight:600;text-transform:uppercase}
.severity.high{background:rgba(248,113,113,.15);color:#f87171}
.severity.medium{background:rgba(251,191,36,.15);color:#fbbf24}
.severity.low{background:rgba(74,222,128,.15);color:#4ade80}
.status{padding:2px 8px;border-radius:4px;font-size:0.8em;font-weight:600}
.status.pending{background:rgba(96,165,250,.12);color:#60a5fa}
.status.applied{background:rgba(74,222,128,.12);color:#4ade80}
.status.denied{background:rgba(248,113,113,.12);color:#f87171}
.update-header{display:flex;align-items:center;gap:8px;margin-bottom:8px}
.session-row{display:flex;align-items:center;gap:8px;padding:8px 0;border-bottom:1px solid var(--border)}
.session-row:last-child{border-bottom:none}
</style>
</head>
<body>
<nav id="topnav"></nav>
<div class="shell" style="padding-top:60px;max-width:1000px">
  <div class="card card-glow" style="margin-bottom:24px;text-align:center">
    <h1 style="margin-bottom:8px">Evolution Dashboard</h1>
    <p class="text-muted">Brain metrics, self-evolution proposals, and autonomous thinking.</p>
    <div id="auth-debug-banner" style="margin-top:8px"></div>
  </div>

  <!-- Metrics -->
  <div class="metrics-grid" style="margin-bottom:24px">
    <div class="metric-card"><div id="m-brain-nodes" class="metric-value">-</div><div class="metric-label">Brain Nodes</div></div>
    <div class="metric-card"><div id="m-learned-facts" class="metric-value">-</div><div class="metric-label">Learned Facts</div></div>
    <div class="metric-card"><div id="m-chats-24h" class="metric-value">-</div><div class="metric-label">Chats (24h)</div></div>
    <div class="metric-card"><div id="m-proposals" class="metric-value">-</div><div class="metric-label">Proposals</div></div>
    <div class="metric-card"><div id="m-cycles" class="metric-value">-</div><div class="metric-label">Think Cycles</div></div>
    <div class="metric-card"><div id="m-unanswered" class="metric-value">-</div><div class="metric-label">Unanswered</div></div>
    <div class="metric-card"><div id="m-warnings" class="metric-value">-</div><div class="metric-label">Warnings</div></div>
    <div class="metric-card"><div id="m-errors" class="metric-value">-</div><div class="metric-label">Errors</div></div>
  </div>

  <!-- Thinker & Topics -->
  <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(320px,1fr));margin-bottom:24px">
    <div class="card card-glow">
      <h3>Autonomous Thinker</h3>
      <div class="data-list">
        <div class="data-list-item"><span>Status</span><span class="row" style="gap:6px"><span id="thinker-dot" class="live-dot off"></span><span id="thinker-status">UNKNOWN</span></span></div>
        <div class="data-list-item"><span>Knowledge Drive</span><span id="thinker-drive" style="font-weight:700">0%</span></div>
      </div>
      <div class="progress" id="drive-bar" style="margin:8px 0"><div class="progress-fill" style="width:0%"></div></div>
      <div class="data-list">
        <div class="data-list-item"><span>Last Cycle</span><span id="thinker-last-cycle" class="text-muted">n/a</span></div>
        <div class="data-list-item"><span>Last Reason</span><span id="thinker-reason" class="text-muted">n/a</span></div>
      </div>
    </div>
    <div class="card">
      <h3>Unknown Topics</h3>
      <div id="unknown-topics" class="scroll-box" style="max-height:200px"><span class="text-muted">Loading...</span></div>
    </div>
  </div>


  <!-- Proposals -->
  <div style="margin-bottom:16px;display:flex;align-items:center;gap:12px;flex-wrap:wrap">
    <h2 style="margin:0">Evolution Proposals</h2>
    <select id="statusFilter" class="form-input" onchange="renderUpdates()" style="width:auto">
      <option value="all">All</option>
      <option value="pending">Pending</option>
      <option value="applied">Applied</option>
      <option value="denied">Denied</option>
    </select>
    <button class="btn btn-ghost btn-sm" onclick="fullRefresh()">Refresh</button>
  </div>
  <div id="updates-list"><div class="text-muted" style="padding:30px;text-align:center">Loading proposals...</div></div>

  <!-- Active Sessions -->
  <div class="card" style="margin-top:24px">
    <h3>Active Sessions</h3>
    <div id="active-sessions" class="scroll-box" style="max-height:250px"><span class="text-muted">Loading sessions...</span></div>
  </div>
</div>

<script src="/webui/auth.js"></script>
<script src="/webui/nav.js"></script>
<script src="/webui/js/evolution.js"></script>
<script>
JeebsNav.init("evolution");
requireAuth("admin").then(function(state) {
  if (state && state.role === "admin") {
    document.getElementById("admin-controls-card").style.display = "";
  }
});
</script>
</body>
</html>
